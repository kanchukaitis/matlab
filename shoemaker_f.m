function [prob,f,details] = shoemaker_f(data1,data2)% SHOEMAKER_F F-test for variances following Shoemaker 2003 %%    [prob,f,details] = shoemaker_f(data1,data2)%% data1   = n1 x 1 vector of data% data2   = n2 x 1 vector of data%% prob    = probability of rejecting the hypothesis of equal variances (smaller p == higher probability of unequal variances; p will be smaller for unequal variances)% f       = ratio of variances% details = internal calculation details for debugging%% Reference:  % Shoemaker, L.H. Fixing the F Test for Equal Variances, The American Statistician, 57(2), 2003%% Written for MATLAB by Kevin Anchukaitis%% Revision history: 11.10.2013, initial public version%[rn1]    = size(data1,1); [rn2] = size(data2,1);mu4      = mean([center(data1).^4; center(data2).^4]);sig4     = (((rn1-1)*var(data1)+(rn2-1)*var(data2)) / (rn1+rn2)).^2;  n1       = (2.0*rn1) / ((mu4/sig4) - ((rn1-3)/(rn1-1)));  % Shoemaker's Equation 1n2       = (2.0*rn2) / ((mu4/sig4) - ((rn2-3)/(rn2-1)));  if n1<2; n1 = 2; end; if n2<2; n2 = 2; end;if var(data1) > var(data2)  f = var(data1)/var(data2); df1 = n1-1; df2 = n2-1;else f = var(data2)/var(data1); df1 = n2-1; df2 = n1-1;endif any(isnan([df1 df2])) prob = NaN;else prob        = 2 .* betainc(df2/(df2+df1*f),0.5*df2,0.5*df1);end details.n1  = n1; details.n2  = n2;if prob > 1; prob = 2 - prob; end